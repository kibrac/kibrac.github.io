<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
<script>
  
  
  (function() {
    const theme = localStorage.getItem('theme');
    if (theme === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
    } else if (theme === 'light') {
      document.documentElement.setAttribute('data-theme', 'light');
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  })();
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>面向对象的程序设计学习笔记 6 | Kibrac&#39;s Blog</title>
<link rel="icon" type="image/png" href="/images/favicon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Montserrat:wght@400;700&family=JetBrains+Mono&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="/css/syntax.css">
<link rel="stylesheet" href="/css/style.css">

</head>
<body class="kind-page section-posts">
    <div id="content">
        <header class="site-header">
    <div class="container">
        <h1><a href="https://kibrac.github.io/">Kibrac&#39;s Blog</a></h1>
        <nav class="site-nav">
            <ul>
                
                
                    
                    
                    
                    <li class="">
                        <a href="/">Home</a>
                    </li>
                
                    
                    
                    
                    <li class="active">
                        <a href="/posts/">Posts</a>
                    </li>
                
                    
                    
                    
                    <li class="">
                        <a href="/archive/">Archive</a>
                    </li>
                
                    
                    
                    
                    <li class="">
                        <a href="/tags/">Tags</a>
                    </li>
                
            </ul>
            <button id="theme-toggle" title="切换暗黑模式"></button>
        </nav>
    </div>
</header>
        <main class="main-content">
            
<article class="post-single">
    <header class="page-header">
        <h1>面向对象的程序设计学习笔记 6</h1>
        
            <p class="page-content">第六章 多态</p>
        
        <div class="post-meta">
            <span>July 31, 2025</span>
            <span class="dot">&middot;</span>
            <span>8 min read</span>
            
                <span class="dot">&middot;</span>
                <div class="tags-inline">
                    
                        <a href="/tags/c&#43;&#43;">C&#43;&#43;</a>
                    
                        <a href="/tags/%E7%AC%94%E8%AE%B0">笔记</a>
                    
                </div>
            
        </div>
    </header>

    <div class="post-content">
        <p>课程链接：<a href="https://www.icourse163.org/course/PKU-1002029030">程序设计与算法（三）C++面向对象程序设计_北京大学_中国大学MOOC(慕课)</a></p>
<h2 id="1虚函数和多态的基本概念">1.虚函数和多态的基本概念</h2>
<h3 id="虚函数">虚函数</h3>
<ul>
<li>在类的定义中，前面有 <code>virtual</code> 关键字的成员函数就是虚函数。</li>
</ul>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">base</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">base</span><span class="o">::</span><span class="n">get</span><span class="p">(){}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><ul>
<li><code>virtual</code> 关键字只用在类定义里的函数声明中，写函数体时不用。</li>
<li>构造函数和静态成员函数不能是虚函数。（关于静态成员函数参考第三章 类和对象提高）</li>
</ul>
<h3 id="多态的表现形式一">多态的表现形式一</h3>
<ul>
<li>派生类的指针可以赋给基类指针。</li>
<li>通过基类指针调用基类和派生类中的同名<strong>虚函数</strong>时：
<ul>
<li>若该指针指向一个基类的对象，那么被调用的是基类的虚函数；</li>
<li>若该指针指向一个派生类的对象，那么被调用的是派生类的虚函数。</li>
</ul>
</li>
</ul>
<p>这种机制就叫做“<strong>多态</strong>”。</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CBase</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">SomeVirtualFunction</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CDerived</span><span class="o">:</span><span class="k">public</span> <span class="n">CBase</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">SomeVirtualFunction</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">CDerived</span> <span class="n">ODerived</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">CBase</span><span class="o">*</span> <span class="n">p</span><span class="o">=&amp;</span><span class="n">ODerived</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">-&gt;</span><span class="n">SomeVirtualFunction</span><span class="p">();</span><span class="c1">//调用哪个虚函数取决于p指向哪种类型的对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><h3 id="多态的表现形式二">多态的表现形式二</h3>
<ul>
<li>派生类的对象可以赋给基类引用。</li>
<li>通过基类引用来调用基类和派生类中的同名<strong>虚函数</strong>时：
<ul>
<li>若该引用引用的是一个基类的对象，那么被调用的是基类的<strong>虚函数</strong>；</li>
<li>若该引用引用的是一个派生类的对象，那么被调用的是派生类的<strong>虚函数</strong>。</li>
</ul>
</li>
</ul>
<p>这种机制也叫做“<strong>多态</strong>”。</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CBase</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">SomeVirtualFunction</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CDerived</span><span class="o">:</span><span class="k">public</span> <span class="n">CBase</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">SomeVirtualFunction</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">CDerived</span> <span class="n">ODerived</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">CBase</span><span class="o">&amp;</span> <span class="n">r</span><span class="o">=</span><span class="n">ODerived</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">r</span><span class="p">.</span><span class="n">SomeVirtualFunction</span><span class="p">();</span><span class="c1">//调用哪个虚函数取决于r引用哪种类型的对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><h3 id="多态的简单示例">多态的简单示例</h3>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Print</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;A::Print&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span><span class="o">:</span><span class="k">public</span> <span class="n">A</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Print</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;B::Print&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">D</span><span class="o">:</span><span class="k">public</span> <span class="n">A</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Print</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;D::Print&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">E</span><span class="o">:</span><span class="k">public</span> <span class="n">B</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Print</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;E::Print&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">A</span> <span class="n">a</span><span class="p">;</span><span class="n">B</span> <span class="n">b</span><span class="p">;</span><span class="n">D</span> <span class="n">d</span><span class="p">;</span><span class="n">E</span> <span class="n">e</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">A</span><span class="o">*</span> <span class="n">pa</span><span class="o">=&amp;</span><span class="n">a</span><span class="p">;</span><span class="n">B</span><span class="o">*</span> <span class="n">pb</span><span class="o">=&amp;</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">D</span><span class="o">*</span> <span class="n">pd</span><span class="o">=&amp;</span><span class="n">d</span><span class="p">;</span><span class="n">E</span><span class="o">*</span> <span class="n">pe</span><span class="o">=&amp;</span><span class="n">e</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pa</span><span class="o">-&gt;</span><span class="n">Print</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">pa</span><span class="o">=</span><span class="n">pb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pa</span><span class="o">-&gt;</span><span class="n">Print</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">pa</span><span class="o">=</span><span class="n">pd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pa</span><span class="o">-&gt;</span><span class="n">Print</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">pa</span><span class="o">=</span><span class="n">pe</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pa</span><span class="o">-&gt;</span><span class="n">Print</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>输出内容为</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">text</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">A::Print
</span></span><span class="line"><span class="cl">B::Print
</span></span><span class="line"><span class="cl">D::Print
</span></span><span class="line"><span class="cl">E::Print</span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>在面向对象的程序设计中使用多态，能够增强程序的<strong>可扩充性</strong>，即程序需要修改或增加功能的时候，需要改动和增加的代码较少。</p>
<h2 id="2多态实例魔法门之英雄无敌">2.多态实例：魔法门之英雄无敌</h2>
<h3 id="非多态实现方式">非多态实现方式</h3>
<p><strong>基本思路</strong></p>
<ul>
<li>为每个怪物类编写 <code>Attack</code>、<code>FightBack</code> 和 <code>Hurted</code> 成员函数。</li>
<li><code>Attack</code> 函数表现攻击动作，攻击某个怪物，并调用被攻击怪物的 <code>Hurted</code> 函数，以减少被攻击怪物的生命值，同时也调用被攻击怪物的 <code>FightBack</code> 函数，遭受被攻击怪物反击。</li>
<li><code>Hurted</code> 函数减少自身生命值，并表现受伤动作。</li>
<li><code>FightBack</code> 函数表现反击动作，并调用被反击对象的 <code>Hurted</code> 函数，使被反击对象受伤。</li>
<li>设置基类 <code>CCreature</code>，并且使 <code>CDragon</code>、<code>CWolf</code> 等其他类都从 <code>CCreature</code> 派生而来。</li>
</ul>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CCreature</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">nPower</span><span class="p">;</span><span class="c1">//攻击力
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">int</span> <span class="n">nLifeValue</span><span class="p">;</span><span class="c1">//生命值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CDragon</span><span class="o">:</span><span class="k">public</span> <span class="n">CCreature</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">void</span> <span class="n">Attack</span><span class="p">(</span><span class="n">CWolf</span><span class="o">*</span> <span class="n">pWolf</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="p">......</span><span class="c1">//表现攻击动作的代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">pWolf</span><span class="o">-&gt;</span><span class="n">Hurted</span><span class="p">(</span><span class="n">nPower</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">pWolf</span><span class="o">-&gt;</span><span class="n">FightBack</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="kt">void</span> <span class="nf">Attack</span><span class="p">(</span><span class="n">CGhost</span><span class="o">*</span> <span class="n">pGhost</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="p">......</span><span class="c1">//表现攻击动作的代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">pGhost</span><span class="o">-&gt;</span><span class="n">Hurted</span><span class="p">(</span><span class="n">nPower</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">pGhost</span><span class="o">-&gt;</span><span class="n">FightBack</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="kt">void</span> <span class="nf">Hurted</span><span class="p">(</span><span class="kt">int</span> <span class="n">nPower</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="p">......</span><span class="c1">//表现受伤动作的代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">nLifeValue</span><span class="o">-=</span><span class="n">nPower</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="kt">void</span> <span class="nf">FightBack</span><span class="p">(</span><span class="n">CWolf</span><span class="o">*</span> <span class="n">pWolf</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="p">......</span><span class="c1">//表现反击动作的代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">pWolf</span><span class="o">-&gt;</span><span class="n">Hurted</span><span class="p">(</span><span class="n">nPower</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span><span class="c1">//这里只是象征性地对反击的攻击力进行了调整
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="kt">void</span> <span class="nf">FightBack</span><span class="p">(</span><span class="n">CGhost</span><span class="o">*</span> <span class="n">pWolf</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="p">......</span><span class="c1">//表现反击动作的代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">pGhost</span><span class="o">-&gt;</span><span class="n">Hurted</span><span class="p">(</span><span class="n">nPower</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><ul>
<li>有 n 种怪物，<code>CDragon</code> 类中就会有 n 个 <code>Attack</code> 成员函数，以及 n 个 <code>FightBack</code> 成员函数等。对于其他类也是如此。</li>
<li>那么如果游戏版本升级，增加了新的怪物雷鸟 <code>CThunderBird</code>，则程序改动就会较大，不光要新增怪物类，其他所有的类都需要增加两个成员函数 ```</li>
</ul>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Attack</span><span class="p">(</span><span class="n">CThunderBird</span><span class="o">*</span> <span class="n">pThunderBird</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">FightBack</span><span class="p">(</span><span class="n">CThunderBird</span><span class="o">*</span> <span class="n">pThunderBird</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><h3 id="多态实现方式">多态实现方式</h3>
<ul>
<li>基类只有一个 <code>Attack</code> 成员函数，也只有一个 <code>FightBack</code> 成员函数；所有 <code>CCreature</code> 的派生类也是这样。</li>
</ul>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CCreature</span><span class="p">{</span><span class="c1">//基类CCreature
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">m_nLifeValue</span><span class="p">,</span><span class="n">m_nPower</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Attack</span><span class="p">(</span><span class="n">CCreature</span><span class="o">*</span> <span class="n">pCreature</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Hurted</span><span class="p">(</span><span class="kt">int</span> <span class="n">nPower</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">FightBack</span><span class="p">(</span><span class="n">CCreature</span><span class="o">*</span> <span class="n">pCreature</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CDragon</span><span class="o">:</span><span class="k">public</span> <span class="n">CCreature</span><span class="p">{</span><span class="c1">//派生类CDragon
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Attack</span><span class="p">(</span><span class="n">CCreature</span><span class="o">*</span> <span class="n">pCreature</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Hurted</span><span class="p">(</span><span class="kt">int</span> <span class="n">nPower</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">FightBack</span><span class="p">(</span><span class="n">CCreature</span><span class="o">*</span> <span class="n">pCreature</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDragon</span><span class="o">::</span><span class="n">Attack</span><span class="p">(</span><span class="n">CCreature</span><span class="o">*</span> <span class="n">p</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="p">......</span><span class="c1">//表现攻击动作的代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">p</span><span class="o">-&gt;</span><span class="n">Hurted</span><span class="p">(</span><span class="n">m_nPower</span><span class="p">);</span><span class="c1">//多态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">p</span><span class="o">-&gt;</span><span class="n">FightBack</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="c1">//多态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDragon</span><span class="o">::</span><span class="n">Hurted</span><span class="p">(</span><span class="kt">int</span> <span class="n">nPower</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="p">......</span><span class="c1">//表现受伤动作的代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">m_nLifeValue</span><span class="o">-=</span><span class="n">nPower</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDragon</span><span class="o">::</span><span class="n">FightBack</span><span class="p">(</span><span class="n">CCreature</span><span class="o">*</span> <span class="n">p</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="p">......</span><span class="c1">//表现反击动作的代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">p</span><span class="o">-&gt;</span><span class="n">Hurted</span><span class="p">(</span><span class="n">m_nPower</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span><span class="c1">//多态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><ul>
<li>在多态的写法中，只需要添加新类 <code>CThunderBird</code>，不需要在已有的类里专门为新怪物增加成员函数，<strong>已有的类可以原封不动</strong>。</li>
</ul>
<p><strong>原理</strong></p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">CDragon</span> <span class="n">Dragon</span><span class="p">;</span><span class="n">CWolf</span> <span class="n">Wolf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">CGhost</span> <span class="n">Ghost</span><span class="p">;</span><span class="n">CThunderBird</span> <span class="n">Bird</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Dragon</span><span class="p">.</span><span class="n">Attack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Wolf</span><span class="p">);</span><span class="c1">//(1)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Dragon</span><span class="p">.</span><span class="n">Attack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Ghost</span><span class="p">);</span><span class="c1">//(2)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Dragon</span><span class="p">.</span><span class="n">Attack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Bird</span><span class="p">);</span><span class="c1">//(3)
</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>根据多态的规则，上面的（1）（2）（3）进入到 <code>CDragon::Attack</code> 函数后，能分别调用 <code>CWolf::Hurted</code>、<code>CGhost::Hurted</code>、<code>CBird::Hurted</code>。</p>
<h2 id="3多态实例几何形体处理程序">3.多态实例：几何形体处理程序</h2>
<h3 id="几何形体处理程序">几何形体处理程序</h3>
<p><strong>情景要求</strong></p>
<p>几何形体处理程序：输入若干个几何形体的参数，要求按面积排序输出，输出时要指明形状。</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">text</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Input
</span></span><span class="line"><span class="cl">第一行是几何形体数目n（不超过100），下面有n行，每行以一个字母开头。
</span></span><span class="line"><span class="cl">若字母为R，则代表一个矩形，本行后面跟着两个整数，分别是矩形的宽和高；
</span></span><span class="line"><span class="cl">若字母为C，则代表一个圆，本行后面跟着一个整数代表其半径；
</span></span><span class="line"><span class="cl">若字母为T，则代表一个三角形，本行后面跟着三个整数，代表三条边的长度。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Output
</span></span><span class="line"><span class="cl">按面积从小到大依次输出每个几何形体的种类及面积。每行一个几何形体，输出格式为
</span></span><span class="line"><span class="cl">形体面积:面积</span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>样例</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">text</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Sample Input
</span></span><span class="line"><span class="cl">3
</span></span><span class="line"><span class="cl">R 3 5
</span></span><span class="line"><span class="cl">C 9
</span></span><span class="line"><span class="cl">T 3 4 5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Sample Output
</span></span><span class="line"><span class="cl">Triangle:6
</span></span><span class="line"><span class="cl">Rectangle:15
</span></span><span class="line"><span class="cl">Circle:254.34</span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>完整代码如下</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CShape</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">double</span> <span class="n">Area</span><span class="p">()</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="c1">//纯虚数：连函数体都没有的虚函数 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">PrintInfo</span><span class="p">()</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CRectangle</span><span class="o">:</span><span class="k">public</span> <span class="n">CShape</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">double</span> <span class="nf">Area</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">PrintInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CCircle</span><span class="o">:</span><span class="k">public</span> <span class="n">CShape</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">double</span> <span class="nf">Area</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">PrintInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CTriangle</span><span class="o">:</span><span class="k">public</span> <span class="n">CShape</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">double</span> <span class="nf">Area</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">PrintInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">double</span> <span class="n">CRectangle</span><span class="o">::</span><span class="n">Area</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">w</span><span class="o">*</span><span class="n">h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CRectangle</span><span class="o">::</span><span class="n">PrintInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Rectangle:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">Area</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">double</span> <span class="n">CCircle</span><span class="o">::</span><span class="n">Area</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mf">3.14</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CCircle</span><span class="o">::</span><span class="n">PrintInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Circle:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">Area</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">double</span> <span class="n">CTriangle</span><span class="o">::</span><span class="n">Area</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="kt">double</span> <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">c</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTriangle</span><span class="o">::</span><span class="n">PrintInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Triangle:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">Area</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">CShape</span><span class="o">*</span> <span class="n">pShapes</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">MyCompare</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">s1</span><span class="p">,</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">s2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="kt">double</span> <span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">CShape</span><span class="o">**</span><span class="n">p1</span><span class="p">;</span><span class="c1">//s1、s2是void*，不可写*s1来获取s1指向的内容 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CShape</span><span class="o">**</span><span class="n">p2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">CShape</span><span class="o">**</span><span class="p">)</span><span class="n">s1</span><span class="p">;</span><span class="c1">//s1、s2指向pShapes数组中的元素，数组元素的类型是CShape* 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">p2</span><span class="o">=</span><span class="p">(</span><span class="n">CShape</span><span class="o">**</span><span class="p">)</span><span class="n">s2</span><span class="p">;</span><span class="c1">//故p1、p2都是指向指针的指针，类型为CShape** 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">a1</span><span class="o">=</span><span class="p">(</span><span class="o">*</span><span class="n">p1</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Area</span><span class="p">();</span><span class="c1">//*p1的类型是CShape*，是基类指针，故此句为多态 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">a2</span><span class="o">=</span><span class="p">(</span><span class="o">*</span><span class="n">p2</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Area</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">a1</span><span class="o">&lt;</span><span class="n">a2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">a2</span><span class="o">&lt;</span><span class="n">a1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span><span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">CRectangle</span><span class="o">*</span> <span class="n">pr</span><span class="p">;</span><span class="n">CCircle</span><span class="o">*</span> <span class="n">pc</span><span class="p">;</span><span class="n">CTriangle</span><span class="o">*</span> <span class="n">pt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="sc">&#39;R&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">				<span class="n">pr</span><span class="o">=</span><span class="k">new</span> <span class="n">CRectangle</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">				<span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">pr</span><span class="o">-&gt;</span><span class="n">w</span> <span class="o">&gt;&gt;</span> <span class="n">pr</span><span class="o">-&gt;</span><span class="n">h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="n">pShapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">pr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="sc">&#39;C&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">				<span class="n">pc</span><span class="o">=</span><span class="k">new</span> <span class="n">CCircle</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">				<span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">pc</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="n">pShapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">pc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="sc">&#39;T&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">				<span class="n">pt</span><span class="o">=</span><span class="k">new</span> <span class="n">CTriangle</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">				<span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">pt</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">&gt;&gt;</span> <span class="n">pt</span><span class="o">-&gt;</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="n">pt</span><span class="o">-&gt;</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="n">pShapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">pt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">qsort</span><span class="p">(</span><span class="n">pShapes</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">CShape</span><span class="o">*</span><span class="p">),</span><span class="n">MyCompare</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">pShapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">PrintInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>如果添加新的几何形体，比如五边形，则只需要从 <code>CShape</code> 派生出 <code>CPentagon</code>，以及在 <code>main</code> 中的 <code>switch</code> 语句中增加一个 <code>case</code>，其余部分都不变，体现了多态在提高程序可扩充性方面具有良好作用。</p>
<ul>
<li>用基类指针数组存放指向各种派生类对象的指针，然后遍历该数组就能对各个派生类对象做各种操作，是很常用的做法。</li>
</ul>
<h3 id="多态的又一例子">多态的又一例子</h3>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">void</span> <span class="n">fun1</span><span class="p">(){</span><span class="n">fun2</span><span class="p">();}</span><span class="c1">//等价于void fun1(){this-&gt;fun2();}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>							<span class="c1">//而this是基类指针，fun2是虚函数，所以是多态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">fun2</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base::fun2()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Derived</span><span class="o">:</span><span class="k">public</span> <span class="n">Base</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">fun2</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Derived:fun2()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">Derived</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Base</span><span class="o">*</span> <span class="n">pBase</span><span class="o">=&amp;</span><span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pBase</span><span class="o">-&gt;</span><span class="n">fun1</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="c1">//输出：Derived:fun2()
</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><ul>
<li><strong>在非构造函数，非析构函数的成员函数中调用虚函数，是多态！！！</strong></li>
<li><strong>在构造函数和析构函数中调用虚函数，不是多态。</strong> 编译时即可确定调用的函数是<strong>自己的类或基类</strong>中定义的函数，不会等到运行时才决定调用自己的还是派生类的函数。</li>
</ul>
<h3 id="构造函数和析构函数中调用虚函数举例">构造函数和析构函数中调用虚函数举例</h3>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">myclass</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">hello</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;hello from myclass&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">bye</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;bye from myclass&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son</span><span class="o">:</span><span class="k">public</span> <span class="n">myclass</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="n">hello</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;hello from son&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">	<span class="n">son</span><span class="p">(){</span><span class="n">hello</span><span class="p">();}</span>
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">son</span><span class="p">(){</span><span class="n">bye</span><span class="p">();}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span><span class="c1">//派生类中和基类中虚函数同名同参数表的函数，不加virtual也自动成为虚函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">grandson</span><span class="o">:</span><span class="k">public</span> <span class="n">son</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">void</span> <span class="n">hello</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;hello from grandson&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">		<span class="kt">void</span> <span class="nf">bye</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;bye from grandson&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">		<span class="n">grandson</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;constructing grandson&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">		<span class="o">~</span><span class="n">grandson</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;destructing grandson&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">grandson</span> <span class="n">gson</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">son</span><span class="o">*</span> <span class="n">pson</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pson</span><span class="o">=&amp;</span><span class="n">gson</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pson</span><span class="o">-&gt;</span><span class="n">hello</span><span class="p">();</span><span class="c1">//多态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>输出内容为</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">text</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">hello</span> <span class="n">from</span> <span class="n">son</span>
</span></span><span class="line"><span class="cl"><span class="n">constructing</span> <span class="n">grandson</span>
</span></span><span class="line"><span class="cl"><span class="n">hello</span> <span class="n">from</span> <span class="n">grandson</span>
</span></span><span class="line"><span class="cl"><span class="n">destructing</span> <span class="n">grandson</span>
</span></span><span class="line"><span class="cl"><span class="n">bye</span> <span class="n">from</span> <span class="n">myclass</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><h2 id="4多态的实现原理">4.多态的实现原理</h2>
<h3 id="问题引入">问题引入</h3>
<p>“多态”的关键在于通过基类指针或引用调用一个虚函数时，编译不确定到底调用的是基类还是派生类的函数，运行时才确定——这叫做 <strong>“动态联编”</strong>。这是如何实现的呢？</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Print</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base:Print&#34;</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Derived</span><span class="o">:</span><span class="k">public</span> <span class="n">Base</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Print</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Derived:Print&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">Derived</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Base</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;,&#34;</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Derived</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>此处的输出内容，在视频中老师的讲解下，理论输出为 <code>4,8</code>，实际输出为 <code>8,12</code>。</p>
<hr>
<p>但事实上在 DEV C++ 5.11 中程序运行得到的结果为 <code>16,16</code> 。该程序的输出取决于编译器的实现和系统位数（32 位或 64 位），但根据常见 64 位系统的行为分析：</p>
<ol>
<li>
<p>​<strong>基类 <code>Base</code> 的大小</strong>​：</p>
<ul>
<li>虚函数表指针（vptr）：<code>8字节</code>（64 位系统指针大小）</li>
<li>成员变量 <code>int i</code>：<code>4字节</code></li>
<li>内存对齐填充：<code>4字节</code>（为了对齐到 8 字节边界）</li>
<li>​<strong>总计</strong>​：<code>8 + 4 + 4 = 16字节</code></li>
</ul>
</li>
<li>
<p>​<strong>派生类 <code>Derived</code> 的大小</strong>​：</p>
<ul>
<li>继承自 <code>Base</code> 的虚函数表指针（vptr）：<code>8字节</code></li>
<li>继承自 <code>Base</code> 的成员变量 <code>int i</code>：<code>4字节</code></li>
<li>新增成员变量 <code>int n</code>：<code>4字节</code></li>
<li>​<strong>总计</strong>​：<code>8 + 4 + 4 = 16字节</code>（无需额外填充，总大小已是 8 的倍数）</li>
</ul>
</li>
</ol>
<p>​<strong>其他可能性</strong>​：</p>
<ul>
<li>​<strong>32 位系统</strong>​：输出 <code>8,12</code>（vptr 占 4 字节，<code>int</code> 占 4 字节，派生类添加的 <code>int</code> 导致总大小 12）。</li>
<li>​<strong>编译器优化</strong>​：某些编译器可能减少填充，但主流通用编译器（如 GCC、Clang、MSVC）在 64 位模式下通常结果为 <code>16,16</code>。</li>
</ul>
<p>​<strong>总结</strong>​：在标准 64 位环境下，程序输出为 <code>16,16</code>。</p>
<hr>
<h3 id="多态实现的关键虚函数表">多态实现的关键——虚函数表</h3>
<p>每一个有虚函数的类（或有虚函数的类的派生类）都有一个<strong>虚函数表</strong>，该类的<strong>任何对象</strong>中都存放了虚函数表的指针。虚函数表中列出了该类的虚函数地址。<strong>多出来的 4 个字节就是用来放虚函数表的地址的。</strong></p>
<p>多态的函数调用语句被编译成一系列根据基类指针所指向的（或基类引用所引用的）对象中存放的虚函数表的地址，在虚函数表中查找虚函数地址，并调用虚函数的指令。</p>
<p>也正因如此，含有多态的程序在执行的过程中会有额外的时间和空间上的开销。(存表和查表的开销)</p>
<h3 id="虚函数表地址验证">虚函数表地址验证</h3>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Func</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">			<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;A::Func&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span><span class="o">:</span><span class="k">public</span> <span class="n">A</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Func</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">			<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;B::Func&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">A</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">A</span><span class="o">*</span> <span class="n">pa</span><span class="o">=</span><span class="k">new</span> <span class="n">B</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">pa</span><span class="o">-&gt;</span><span class="n">Func</span><span class="p">();</span><span class="c1">//64位程序指针为8字节，输出B::Func 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">long</span> <span class="kt">long</span><span class="o">*</span> <span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">long</span> <span class="kt">long</span><span class="o">*</span> <span class="n">p2</span><span class="o">=</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)</span><span class="n">pa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="n">p2</span><span class="o">=*</span><span class="n">p1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pa</span><span class="o">-&gt;</span><span class="n">Func</span><span class="p">();</span><span class="c1">//输出A::Func 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><hr>
<p>这段代码很好地演示了 C++ 虚函数表的底层实现机制，我们可以分几个层次来理解：</p>
<p>​<strong>类结构分析</strong>​</p>
<ul>
<li>基类 <code>A</code> 定义了一个虚函数 <code>Func()</code>，输出 &ldquo;A::Func&rdquo;</li>
<li>派生类 <code>B</code> 重写了 <code>Func()</code>，输出 &ldquo;B::Func&rdquo;</li>
<li><code>B</code> 继承自 <code>A</code>，形成继承体系</li>
</ul>
<p>​<strong>虚函数表原理</strong>​</p>
<ul>
<li>编译器会为每个包含虚函数的类生成虚函数表（vtable）</li>
<li>每个对象实例化时会包含一个隐藏的虚表指针（vptr），指向对应的虚表</li>
<li><code>A</code> 的虚表存放 <code>A::Func</code> 的地址，<code>B</code> 的虚表存放 <code>B::Func</code> 的地址</li>
</ul>
<p>​<strong>内存操作解析</strong>​</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">long</span> <span class="kt">long</span><span class="o">*</span> <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>  <span class="c1">// 获取A实例的虚表指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">long</span> <span class="kt">long</span><span class="o">*</span> <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)</span><span class="n">pa</span><span class="p">;</span>  <span class="c1">// 获取B实例的虚表指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="o">*</span><span class="n">p1</span><span class="p">;</span>  <span class="c1">// 用A的虚表覆盖B的虚表
</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><ul>
<li>这里利用了 64 位系统中指针占 8 字节的特性（<code>long long</code> 也是 8 字节）</li>
<li>通过直接操作内存，修改了 <code>B</code> 实例的虚表指针，使其指向 <code>A</code> 的虚表</li>
</ul>
<p><strong>运行结果解释</strong>​</p>
<ul>
<li>第一次调用 <code>pa-&gt;Func()</code>：正常输出 <code>B::Func</code>，符合多态特性</li>
<li>修改虚表指针后：<code>pa</code> 实际指向的对象虽然还是 <code>B</code> 类型，但虚表已被替换为 <code>A</code> 的，故输出 <code>A::Func</code></li>
</ul>
<p><strong>重要概念验证</strong>​</p>
<ul>
<li>虚函数调用是通过查虚表实现的动态绑定，而非通过对象本身的类型</li>
<li>虚表指针存在于对象实例的内存起始位置</li>
<li>多态的实现依赖于虚表机制，而不是简单的类型继承</li>
</ul>
<p><strong>注意事项</strong>​</p>
<ul>
<li>这种直接操作内存的方式在实际开发中非常危险，会破坏面向对象特性</li>
<li>不同编译器实现可能有差异，此处演示的是典型实现方式</li>
<li>32 位系统需要将 <code>long long</code> 改为 <code>long</code>（4 字节）</li>
</ul>
<p>这个例子深刻揭示了 C++ 多态性的底层实现，帮助我们理解：虚函数调用实际上是通过虚表指针间接跳转的，当修改了虚表指针后，即使对象类型未变，虚函数的行为也会改变。这是实现运行时多态的关键机制。</p>
<hr>
<h2 id="5虚析构函数纯虚函数和抽象类">5.虚析构函数、纯虚函数和抽象类</h2>
<h3 id="虚析构函数">虚析构函数</h3>
<p>通过基类的指针删除派生类对象时，通常情况下只调用基类的析构函数。</p>
<ul>
<li>但是，删除一个派生类的对象时，应该先调用派生类的析构函数，然后调用基类的析构函数。</li>
</ul>
<p>解决办法：把基类的<strong>析构函数声明为 <code>virtual</code></strong>。</p>
<ul>
<li>派生类的析构函数可以 <code>virtual</code> 不进行声明。</li>
<li>通过基类的指针删除派生类对象时，首先调用派生类的析构函数，然后调用基类的析构函数。</li>
</ul>
<p>一般来说，一个类如果定义了虚函数，则应该将析构函数也定义成虚函数。或者，一个类打算作为基类使用，也应该将析构函数定义成虚函数。</p>
<p>注意：<strong>不允许以虚函数作为构造函数</strong>。</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="o">~</span><span class="n">son</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;bye from son&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">grandson</span><span class="o">:</span><span class="k">public</span> <span class="n">son</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="o">~</span><span class="n">grandson</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;bye from grandson&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">son</span><span class="o">*</span> <span class="n">pson</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pson</span><span class="o">=</span><span class="k">new</span> <span class="n">grandson</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">delete</span> <span class="n">pson</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="c1">//输出：bye from son，没有执行grandson::~grandson()
</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>如果将基类的析构函数声明为 <code>virtual</code></p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="o">~</span><span class="n">son</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;bye from son&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">grandson</span><span class="o">:</span><span class="k">public</span> <span class="n">son</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="o">~</span><span class="n">grandson</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;bye from grandson&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">son</span><span class="o">*</span> <span class="n">pson</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pson</span><span class="o">=</span><span class="k">new</span> <span class="n">grandson</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">delete</span> <span class="n">pson</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>则会输出</p>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">text</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">bye from grandson
</span></span><span class="line"><span class="cl">bye from son</span></span></code></pre></td></tr></table>
</div>
</div>
</div><p>执行 <code>grandson::~grandson()</code>，引起执行 <code>son::~son()</code>。</p>
<h3 id="纯虚函数和抽象类">纯虚函数和抽象类</h3>
<ul>
<li><strong>纯虚函数：没有函数体的虚函数</strong></li>
</ul>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="c1">//纯虚函数，如果不是=0而是{}，也认为是有函数体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><ul>
<li><strong>包含纯虚函数的类叫抽象类</strong>
<ul>
<li>抽象类只能作为基类来派生新类使用，不能创建抽象类的对象</li>
<li>抽象类的指针和引用可以指向由抽象类派生出来的类的对象</li>
</ul>
</li>
</ul>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">A</span> <span class="n">a</span><span class="p">;</span><span class="c1">//错，A是抽象类，不能创建对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">A</span><span class="o">*</span> <span class="n">pa</span><span class="p">;</span><span class="c1">//ok，可以定义抽象类的指针和引用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pa</span><span class="o">=</span><span class="k">new</span> <span class="n">A</span><span class="p">;</span><span class="c1">//错误，A是抽象类，不能创建对象
</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div><ul>
<li><strong>在抽象类的成员函数内可以调用纯虚函数，但是在构造函数或析构函数内部不能调用纯虚函数。</strong></li>
<li><strong>如果一个类从抽象类派生而来，那么当且仅当它实现了基类中所有纯虚函数，它才能成为非抽象类。</strong>（也就是说基类中的所有纯虚函数在派生类中都有了函数体）</li>
</ul>
<div class="code-block-wrapper">
    <div class="code-block-header">
        <span class="language-name">cpp</span>
        <button class="copy-code-button" aria-label="Copy code to clipboard">
            <i class="fa-regular fa-copy"></i>
            <span class="copy-text">Copy</span>
            <span class="copied-text" style="display: none;">Copied!</span>
        </button>
    </div>
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">f</span><span class="p">()</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="c1">//纯虚函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">void</span> <span class="nf">g</span><span class="p">(){</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">();}</span><span class="c1">//ok
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//A(){f();}//编译错误，构造函数中不是多态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span><span class="o">:</span><span class="k">public</span> <span class="n">A</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="kt">void</span> <span class="n">f</span><span class="p">(){</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;B:f()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">B</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">b</span><span class="p">.</span><span class="n">g</span><span class="p">();</span><span class="c1">//输出B:f()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
    </div>

    
<nav class="post-navigation">
    
    <a href="/posts/c&#43;&#43;5/" class="prev">
        &laquo; 面向对象的程序设计学习笔记 5
    </a>
    
    
    
    <a href="/posts/llm-deploy-locally/" class="next">
        本地部署大模型——Safetensors格式 &raquo;
    </a>
    
</nav>


</article>


<aside class="hover-toc">
    <div class="hover-toc-indicator"></div>
    <div class="hover-toc-panel">
        <h4>In this article</h4>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#1虚函数和多态的基本概念">1.虚函数和多态的基本概念</a>
      <ul>
        <li><a href="#虚函数">虚函数</a></li>
        <li><a href="#多态的表现形式一">多态的表现形式一</a></li>
        <li><a href="#多态的表现形式二">多态的表现形式二</a></li>
        <li><a href="#多态的简单示例">多态的简单示例</a></li>
      </ul>
    </li>
    <li><a href="#2多态实例魔法门之英雄无敌">2.多态实例：魔法门之英雄无敌</a>
      <ul>
        <li><a href="#非多态实现方式">非多态实现方式</a></li>
        <li><a href="#多态实现方式">多态实现方式</a></li>
      </ul>
    </li>
    <li><a href="#3多态实例几何形体处理程序">3.多态实例：几何形体处理程序</a>
      <ul>
        <li><a href="#几何形体处理程序">几何形体处理程序</a></li>
        <li><a href="#多态的又一例子">多态的又一例子</a></li>
        <li><a href="#构造函数和析构函数中调用虚函数举例">构造函数和析构函数中调用虚函数举例</a></li>
      </ul>
    </li>
    <li><a href="#4多态的实现原理">4.多态的实现原理</a>
      <ul>
        <li><a href="#问题引入">问题引入</a></li>
        <li><a href="#多态实现的关键虚函数表">多态实现的关键——虚函数表</a></li>
        <li><a href="#虚函数表地址验证">虚函数表地址验证</a></li>
      </ul>
    </li>
    <li><a href="#5虚析构函数纯虚函数和抽象类">5.虚析构函数、纯虚函数和抽象类</a>
      <ul>
        <li><a href="#虚析构函数">虚析构函数</a></li>
        <li><a href="#纯虚函数和抽象类">纯虚函数和抽象类</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</aside>


        </main>
        <footer class="site-footer">
    <div class="container">
        <p>&copy; 2025 Kibrac. All rights reserved.</p>
    </div>
</footer>

    </div>
    <a id="back-to-top" href="#" title="返回顶部">&uarr;</a>
    <script src="/js/theme-switcher.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>
